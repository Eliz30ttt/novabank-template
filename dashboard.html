<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NovaBank - Dashboard</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body onload="initApp()">

<div class="header" id="headerSection">
  <img src="https://i.pravatar.cc/60?img=12" alt="Avatar" class="avatar">
  <div class="header-info">
    <h2>Kelvin Brooks</h2>
    <p id="lastLogin"></p>
  </div>
  <div class="header-right">
    <img src="https://cdn-icons-png.flaticon.com/512/1827/1827301.png" alt="Notifications" class="icon">
    <span class="notif-badge" id="notifBadge">3</span>
    <button class="secondary-btn" onclick="goProfile()" style="margin-left:10px;">Profile</button>
  </div>
</div>

<div class="dashboard" id="dashboardSection">
  <h2 class="welcome-msg">Welcome, Kelvin Brooks</h2>
  <div class="card gradient-card">
    <h3>Current Balance</h3>
    <p id="balance" class="strong-balance white-balance">$0.00</p>
    <p class="account-number">Account: **** **** **** 4821</p>
    <span class="badge">FDIC-insured</span>
  </div>
  <div class="dashboard-actions">
    <button class="primary-btn" onclick="showSend()">Send Money</button>
    <button class="primary-btn" onclick="showReceive()">Receive Money</button>
    <button class="primary-btn" onclick="showAdd()">Add Money</button>
    <button class="primary-btn" onclick="showRequest()">Request Money</button>
  </div>
  <h3>Recent Transactions</h3>
  <div id="transactions"></div>
</div>

<!-- Send -->
<div class="container" id="sendSection" style="display:none;">
  <h2>Send Money</h2>
  <input type="email" id="recipient" placeholder="Recipient Email" required>
  <input type="number" id="amount" placeholder="Amount" required>
  <button class="primary-btn" id="sendBtn">Confirm Transfer</button>
  <button class="secondary-btn" onclick="showDashboard()">Cancel</button>
</div>

<!-- Receive -->
<div class="container" id="receiveSection" style="display:none;">
  <h2>Receive Money</h2>
  <input type="text" id="sender" placeholder="Sender Name" required>
  <input type="number" id="receiveAmount" placeholder="Amount" required>
  <button class="primary-btn" id="receiveBtn">Confirm Receipt</button>
  <button class="secondary-btn" onclick="showDashboard()">Cancel</button>
</div>

<!-- Add -->
<div class="container" id="addSection" style="display:none;">
  <h2>Add Money</h2>
  <input type="number" id="addAmount" placeholder="Amount" required>
  <button class="primary-btn" id="addBtn">Add Funds</button>
  <button class="secondary-btn" onclick="showDashboard()">Cancel</button>
</div>

<!-- Request -->
<div class="container" id="requestSection" style="display:none;">
  <h2>Request Money</h2>
  <input type="text" id="requestName" placeholder="Who to request from" required>
  <input type="number" id="requestAmount" placeholder="Amount" required>
  <button class="primary-btn" id="requestBtn">Generate Request</button>
  <button class="secondary-btn" onclick="showDashboard()">Cancel</button>
</div>

<!-- Toast -->
<div id="toast" class="toast"></div>

<script>
// -------------------- INIT --------------------
function initApp() {
  if(!localStorage.getItem("balance") || isNaN(localStorage.getItem("balance"))) localStorage.setItem("balance","4820.55");
  if(!localStorage.getItem("transactions")) localStorage.setItem("transactions",JSON.stringify(["Received $120.00 from Alice","Sent $50.00 to Bob"]));
  updateLastLogin(); updateNotifications(); loadDashboard(); setupInputValidation();
}

function updateLastLogin() {
  const now=new Date();
  const options={ weekday:'short', month:'short', day:'numeric', hour:'2-digit', minute:'2-digit'};
  document.getElementById("lastLogin").innerText="Last login: "+now.toLocaleString('en-US',options);
}

// -------------------- DASHBOARD --------------------
function loadDashboard() {
  const balance=parseFloat(localStorage.getItem("balance"))||0;
  document.getElementById("balance").innerText="$"+balance.toFixed(2);
  const transactions=JSON.parse(localStorage.getItem("transactions")||"[]");
  const container=document.getElementById("transactions");
  container.innerHTML="";
  transactions.forEach(tx=>{
    const div=document.createElement("div");
    div.classList.add("transaction-card");
    let isSent=tx.toLowerCase().includes("sent");
    let isReceived=tx.toLowerCase().includes("received");
    if(isSent){ div.innerHTML=`ðŸ”´ ${tx}`; div.style.color="#ff4d4d"; }
    else if(isReceived){ div.innerHTML=`ðŸŸ¢ ${tx}`; div.style.color="#00b894"; }
    else{ div.innerHTML=`ðŸŸ¡ ${tx}`; div.style.color="#ffa500"; }
    container.appendChild(div);
  });
}

function showSection(id){ ["sendSection","receiveSection","addSection","requestSection"].forEach(s=>document.getElementById(s).style.display=s===id?"block":"none"); document.getElementById("dashboardSection").style.display=id?"none":"block"; document.getElementById("headerSection").style.display=id?"none":"flex"; loadDashboard();}
function showSend(){ showSection("sendSection"); }
function showReceive(){ showSection("receiveSection"); }
function showAdd(){ showSection("addSection"); }
function showRequest(){ showSection("requestSection"); }
function showDashboard(){ showSection(""); document.getElementById("dashboardSection").style.display="block"; document.getElementById("headerSection").style.display="flex"; loadDashboard(); }
function goProfile(){ window.location.href="profile.html"; }

// -------------------- INPUT VALIDATION --------------------
function setupInputValidation(){
  const inputs=["amount","recipient","receiveAmount","sender","addAmount","requestAmount","requestName"];
  inputs.forEach(id=>{
    const el=document.getElementById(id);
    if(!el) return;
    el.addEventListener("input",()=>{
      const val=el.value.trim();
      if(id.includes("Amount")){ const num=parseFloat(val); if(!isNaN(num)&&num>0){ el.classList.add("valid"); el.classList.remove("invalid"); } else { el.classList.add("invalid"); el.classList.remove("valid"); } }
      if(id.includes("recipient")||id.includes("sender")||id.includes("requestName")){ if(val.length>0){ el.classList.add("valid"); el.classList.remove("invalid"); } else { el.classList.add("invalid"); el.classList.remove("valid"); }
    });
  });
}

// -------------------- TOAST --------------------
function showToast(message){ const toast=document.getElementById("toast"); toast.innerText=message; toast.className="toast show"; setTimeout(()=>{ toast.className="toast"; },2500); }

// -------------------- ACTIONS --------------------
// Send
document.getElementById("sendBtn")?.addEventListener("click",()=>{
  const amount=parseFloat(document.getElementById("amount").value)||0;
  const recipient=document.getElementById("recipient").value||"Unknown";
  let balance=parseFloat(localStorage.getItem("balance"))||0;
  if(amount<=0){ alert("Enter a valid amount"); return; }
  if(amount>balance){ alert("Insufficient funds"); return; }
  balance-=amount; localStorage.setItem("balance",balance.toFixed(2));
  const transactions=JSON.parse(localStorage.getItem("transactions")||"[]");
  transactions.unshift(`Sent $${amount.toFixed(2)} to ${recipient}`);
  localStorage.setItem("transactions",JSON.stringify(transactions));
  document.getElementById("recipient").value=""; document.getElementById("amount").value="";
  showToast(`$${amount.toFixed(2)} sent to ${recipient}`);
  showDashboard();
});

// Receive
document.getElementById("receiveBtn")?.addEventListener("click",()=>{
  const amount=parseFloat(document.getElementById("receiveAmount").value)||0;
  const sender=document.getElementById("sender").value||"Unknown";
  if(amount<=0){ alert("Enter a valid amount"); return; }
  let balance=parseFloat(localStorage.getItem("balance"))||0;
  balance+=amount; localStorage.setItem("balance",balance.toFixed(2));
  const transactions=JSON.parse(localStorage.getItem("transactions")||"[]");
  transactions.unshift(`Received $${amount.toFixed(2)} from ${sender}`);
  localStorage.setItem("transactions",JSON.stringify(transactions));
  document.getElementById("sender").value=""; document.getElementById("receiveAmount").value="";
  showToast(`$${amount.toFixed(2)} received from ${sender}`);
  showDashboard();
});

// Add
document.getElementById("addBtn")?.addEventListener("click",()=>{
  const amount=parseFloat(document.getElementById("addAmount").value)||0;
  if(amount<=0){ alert("Enter a valid amount"); return; }
  let balance=parseFloat(localStorage.getItem("balance"))||0;
  balance+=amount; localStorage.setItem("balance",balance.toFixed(2));
  const transactions=JSON.parse(localStorage.getItem("transactions")||"[]");
  transactions.unshift(`Added $${amount.toFixed(2)} to account`);
  localStorage.setItem("transactions",JSON.stringify(transactions));
  document.getElementById("addAmount").value="";
  showToast(`$${amount.toFixed(2)} added to your account`);
  showDashboard();
});

// Request
document.getElementById("requestBtn")?.addEventListener("click",()=>{
  const amount=parseFloat(document.getElementById("requestAmount").value)||0;
  const name=document.getElementById("requestName").value||"Someone";
  if(amount<=0){ alert("Enter a valid amount"); return; }
  const transactions=JSON.parse(localStorage.getItem("transactions")||"[]");
  transactions.unshift(`Requested $${amount.toFixed(2)} from ${name}`);
  localStorage.setItem("transactions",JSON.stringify(transactions));
  document.getElementById("requestName").value=""; document.getElementById("requestAmount").value="";
  showToast(`$${amount.toFixed(2)} requested from ${name}`);
  showDashboard();
});

// Notifications
function updateNotifications(){ const notifCount=Math.floor(Math.random()*5)+1; document.getElementById("notifBadge").innerText=notifCount; }

</script>
</body>
</html>
